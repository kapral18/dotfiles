#!/usr/bin/env bash

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

show_usage() {
  cat <<EOF
Usage: f-wtree <command> [options]

Commands:
  add <branch_name> [base_branch]    Add a worktree for a branch
  prs [pr_numbers... | search]       Fetch PRs and create worktrees
  remove                             Remove worktrees interactively

Options:
  -h, --help                         Show this help message

Run 'f-wtree <command> --help' for more information on a command.
EOF
}

if [ $# -eq 0 ]; then
  show_usage
  exit 1
fi

case "$1" in
  -h|--help)
    show_usage
    exit 0
    ;;
  add)
    shift
    exec bash "$SCRIPT_DIR/utils/wt/wt_add.sh" "$@"
    ;;
  prs)
    shift
    exec bash "$SCRIPT_DIR/utils/wt/wt_prs.sh" "$@"
    ;;
  remove)
    shift
    exec bash "$SCRIPT_DIR/utils/wt/wt_remove.sh" "$@"
    ;;
  *)
    echo "Error: Unknown command '$1'" >&2
    echo >&2
    show_usage
    exit 1
    ;;
esac
